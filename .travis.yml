language: ruby
dist: xenial
addons:
  snaps:
  - name: helm
    classic: true

before_install:
- openssl aes-256-cbc -K $encrypted_8a2a23268e29_key -iv $encrypted_8a2a23268e29_iv
  -in gcs-credentials.json.enc -out gcs-credentials.json -d

before_script:
- helm init --client-only

before_deploy:
- ls dist

deploy:
  provider: gcs
  edge: true
  # project_id: eco-emissary-99515
  access_key_id: GOOGLOFVBSVM5UVI7HVV7T5V
  secret_access_key:
    secure: Kq6DlxLi9hLO3l8mYYmx0AxpZYMM26DA9NcupExPCWxDudHxrf+yHzhJpXcrA7zwVwkLwD+bSsjedjDIHLXM76nW98ZHN1CGyU3kcmPE9dzmbGNfmvYHvBgsEXtkcQjqjoYV7tXhifYhPvzvrRKpLMD7iT+graElZ9glhPKNYqoTPsLnL6N/MeAKk2zNhkNKAISIBlbenDRYwz9bmmgXoYjafkpUbg27oIA9btnTqWhKugbB0wvzFSCsld9JUJm4Yld3dODuaFT3Pamfi9Qym7cRhGc6zq00prPoVQwF3hJsBV0Jqjq0/DxRCmLRGe+zgUhYdT3TSfYNFKWZhfLPPZ+alxaGNWFICkf839jwo8kJAhpy8u38c6lXf24/zVl1uY4VeH2UfUsAxyga2NXM6QMAqvzLkJKC1y2Ia4geJQzyrhkd91ZvvSLzHfMWy18lxtXLtmY+/bNEwwfhYVE/r1XifkVtusa8AfvsOCiyUoKxcWWUR7gT1e8X+LpRa7KMkcaq+KI1spkL4kq9VV/f0B+kV0YJ4y/lnY6THux/ztbZIJGtq7so97ea9x8OSjgLMzXbLvFGZ9SOLmzOz+4NQkiJC75DyENNO4/AEXBqGj6fDTH23HYu4ZNu5784/RXZxM2TuJF7wRxYCxMwPTTB51fiaDtPsimfCndbIipPOjc=
  bucket: travis-ci-helm-charts
  local_dir: dist
  acl: public-read
  on:
    repo: travis-ci/kubernetes-config

after_success:
- "./shared/update-staging.sh"

branches:
  except:
  - flux-sync
  - flux-write-check
